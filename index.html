<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Aura Flow Collection</title>
<!-- Подключение шрифта Pacifico -->
<link href="https://fonts.googleapis.com/css2?family=Pacifico&display=swap" rel="stylesheet" />
<link href="https://fonts.googleapis.com/css2?family=Roboto&display=swap" rel="stylesheet" />
<link href="https://fonts.googleapis.com/css2?family=Montserrat&display=swap" rel="stylesheet" />
<!-- Иконки FontAwesome -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
/* Все ваши существующие стили остаются без изменений */
/* Добавляем только новые стили для расчета доставки */

.delivery-calculator {
  background: #f9f9f9;
  border-radius: 10px;
  padding: 15px;
  margin: 15px 0;
  border: 1px solid #e0e0e0;
}

.delivery-calculator h4 {
  margin-top: 0;
  margin-bottom: 10px;
  font-size: 16px;
}

.delivery-inputs {
  display: flex;
  gap: 10px;
  margin-bottom: 10px;
}

.delivery-inputs input {
  flex: 1;
  padding: 8px 12px;
  border: 1px solid #ccc;
  border-radius: 5px;
  font-size: 14px;
}

#calculate-delivery {
  background: #000;
  color: white;
  border: none;
  padding: 8px 16px;
  border-radius: 5px;
  cursor: pointer;
  font-size: 14px;
}

#calculate-delivery:disabled {
  background: #666;
  cursor: not-allowed;
}

.delivery-results {
  margin-top: 10px;
}

.delivery-option {
  display: flex;
  justify-content: space-between;
  padding: 8px 0;
  border-bottom: 1px solid #eee;
}

.delivery-option:last-child {
  border-bottom: none;
}

.delivery-price {
  font-weight: bold;
  color: #000;
}

.delivery-error {
  color: #d32f2f;
  font-size: 14px;
  margin-top: 10px;
}

.loading {
  color: #666;
  font-style: italic;
}

/* Стиль для ссылок названий товаров */
.product h3 a {
  text-decoration: none;
  color: inherit;
  transition: color 0.3s ease;
}

.product h3 a:hover {
  color: #666;
}
</style>
<link rel="icon" href="ДОРАБОТКА.png" sizes="512x512" type="image/png">
</head>
<body>

<!-- Ваш существующий HTML код остается без изменений до блока товаров -->

<!-- Контейнер товаров -->
<div class="products" id="products-container">
  <!-- Товары будут добавлены программно -->
</div>

<!-- Кнопка возвращения вверх -->
<button id="back-to-top">↑</button>

<!-- Модальное окно корзины -->
<div id="cart-modal">
  <div id="cart-content">
    <button id="close-cart">✕</button>
    <h2>Корзина</h2>
    <div id="cart-items">
      <!-- Товары в корзине -->
    </div>
    
    <!-- Блок расчета доставки -->
    <div class="delivery-calculator">
      <h4>Расчет доставки</h4>
      <div class="delivery-inputs">
        <input type="text" id="delivery-city" placeholder="Город доставки" required>
        <button id="calculate-delivery">Рассчитать</button>
      </div>
      <div id="delivery-results" class="delivery-results">
        <!-- Результаты расчета появятся здесь -->
      </div>
    </div>
    
    <form id="cart-form">
      <input type="text" placeholder="ФИО" required>
      <input type="text" placeholder="Город" required id="form-city">
      <input type="text" placeholder="Адрес" required>
      <select id="delivery-method" required>
        <option value="">Выберите способ доставки</option>
        <option value="sdek">СДЭК</option>
        <option value="post">Почта России</option>
      </select>
      <div id="delivery-cost-display" style="margin: 10px 0; font-size: 14px; display: none;">
        Стоимость доставки: <span id="delivery-cost">0</span> ₽
      </div>
      <div id="cart-total">Итого: 0 ₽</div>
      <button type="button" id="checkout-btn">Оформить заказ</button>
    </form>
  </div>
</div>

<!-- Футер -->
<div class="footer">
  <!-- Ваш существующий футер -->
</div>

<script>
// Массив товаров с изображениями
const products = [
  { 
    name: 'Футболка "Luxury That Breathes" Black', 
    price: 2990, 
    image: 'product1.jpg',
    hoverImage: 'product1-hover.jpg',
    preorder: false,
    link: 't-shirt1.html' // Добавляем ссылку на страницу товара
  },
  { 
    name: 'Футболка "Luxury That Breathes" White', 
    price: 2990, 
    image: 'product2.jpg',
    hoverImage: 'product2-hover.jpg',
    preorder: true,
    link: 't-shirt1.html'
  },
  { 
    name: 'Футболка "Luxury That Breathes" Grey', 
    price: 2990, 
    image: 'product3.jpg',
    hoverImage: 'product3-hover.jpg',
    preorder: true,
    link: 't-shirt1.html'
  },
  { 
    name: 'Шапка', 
    price: 1200, 
    image: 'product4.jpg',
    hoverImage: 'product4-hover.jpg',
    preorder: false,
    link: 't-shirt1.html'
  },
];

// функция отображения товаров - ОБНОВЛЕНА
function renderProducts() {
  const container = document.getElementById('products-container');
  container.innerHTML = '';
  products.forEach((prod, index) => {
    const div = document.createElement('div');
    div.className = 'product';
    div.innerHTML = `
      <div class="product-image">
        <img src="${prod.image}" alt="${prod.name}" class="main-image">
        <img src="${prod.hoverImage}" alt="${prod.name}" class="hover-image">
      </div>
      <h3><a href="${prod.link}">${prod.name}</a></h3>
      <p>Цена: ${prod.price} ₽</p>
      <button data-index="${index}">${prod.preorder ? 'Оформить предзаказ' : 'Добавить в корзину'}</button>
    `;
    container.appendChild(div);
  });
}

// Функции для расчета доставки
async function calculateDelivery(city) {
  const resultsDiv = document.getElementById('delivery-results');
  resultsDiv.innerHTML = '<div class="loading">Рассчитываем стоимость доставки...</div>';
  
  try {
    // Расчет для СДЭК
    const sdekCost = await calculateSDEK(city);
    // Расчет для Почты России
    const postCost = await calculatePostRussia(city);
    
    resultsDiv.innerHTML = `
      <div class="delivery-option">
        <span>СДЭК</span>
        <span class="delivery-price">${sdekCost} ₽</span>
      </div>
      <div class="delivery-option">
        <span>Почта России</span>
        <span class="delivery-price">${postCost} ₽</span>
      </div>
    `;
    
    // Сохраняем цены для использования в форме
    window.deliveryPrices = {
      sdek: sdekCost,
      post: postCost
    };
    
  } catch (error) {
    resultsDiv.innerHTML = `<div class="delivery-error">Не удалось рассчитать доставку. Проверьте название города.</div>`;
    console.error('Ошибка расчета доставки:', error);
  }
}

// Расчет стоимости доставки СДЭК
async function calculateSDEK(city) {
  // Здесь будет реальный API запрос к СДЭК
  // Пока используем mock данные на основе расстояния
  
  const citiesDistance = {
    'москва': 650,
    'санкт-петербург': 700,
    'казань': 350,
    'нижний новгород': 250,
    'самара': 500,
    'екатеринбург': 900,
    'новосибирск': 1900,
    'краснодар': 1100,
    'ростов-на-дону': 1000,
    'челябинск': 1100
  };
  
  const normalizedCity = city.toLowerCase();
  const distance = citiesDistance[normalizedCity] || 800;
  
  // Базовая формула расчета (примерная)
  const baseCost = 300;
  const costPerKm = 0.5;
  let calculatedCost = Math.round(baseCost + (distance * costPerKm));
  
  // Минимальная и максимальная стоимость
  calculatedCost = Math.max(400, Math.min(calculatedCost, 2000));
  
  return calculatedCost;
}

// Расчет стоимости доставки Почтой России
async function calculatePostRussia(city) {
  // Аналогично СДЭК, но с другими тарифами
  
  const citiesDistance = {
    'москва': 650,
    'санкт-петербург': 700,
    'казань': 350,
    'нижний новгород': 250,
    'самара': 500,
    'екатеринбург': 900,
    'новосибирск': 1900,
    'краснодар': 1100,
    'ростов-на-дону': 1000,
    'челябинск': 1100
  };
  
  const normalizedCity = city.toLowerCase();
  const distance = citiesDistance[normalizedCity] || 800;
  
  // Почта России обычно дешевле
  const baseCost = 200;
  const costPerKm = 0.3;
  let calculatedCost = Math.round(baseCost + (distance * costPerKm));
  
  // Минимальная и максимальная стоимость
  calculatedCost = Math.max(300, Math.min(calculatedCost, 1500));
  
  return calculatedCost;
}

// Обновленная функция обновления корзины с учетом доставки
function updateCartModal() {
  const cart = JSON.parse(localStorage.getItem('cart')) || [];
  const cartItems = document.getElementById('cart-items');
  const cartTotal = document.getElementById('cart-total');
  
  cartItems.innerHTML = '';
  let itemsTotal = 0;
  
  cart.forEach((item, index) => {
    const itemTotal = item.price * item.count;
    itemsTotal += itemTotal;
    
    const itemElement = document.createElement('div');
    itemElement.className = 'cart-item';
    itemElement.innerHTML = `
      <img src="${item.image}" alt="${item.name}" class="cart-item-image">
      <div class="cart-item-info">
        <div class="cart-item-name">${item.name}</div>
        <div class="cart-item-price">${item.price} ₽ x ${item.count}</div>
      </div>
      <div class="cart-item-controls">
        <button data-index="${index}" data-action="decrease">-</button>
        <span>${item.count}</span>
        <button data-index="${index}" data-action="increase">+</button>
        <button data-index="${index}" data-action="remove">✕</button>
      </div>
    `;
    cartItems.appendChild(itemElement);
  });
  
  // Обновляем общую сумму с учетом доставки
  updateTotalWithDelivery(itemsTotal);
}

// Функция обновления общей суммы с доставкой
function updateTotalWithDelivery(itemsTotal) {
  const deliveryMethod = document.getElementById('delivery-method');
  const deliveryCostDisplay = document.getElementById('delivery-cost-display');
  const deliveryCostSpan = document.getElementById('delivery-cost');
  const cartTotal = document.getElementById('cart-total');
  
  let deliveryCost = 0;
  
  if (deliveryMethod.value && window.deliveryPrices) {
    deliveryCost = window.deliveryPrices[deliveryMethod.value] || 0;
    deliveryCostDisplay.style.display = 'block';
    deliveryCostSpan.textContent = deliveryCost;
  } else {
    deliveryCostDisplay.style.display = 'none';
  }
  
  const total = itemsTotal + deliveryCost;
  cartTotal.textContent = `Итого: ${total} ₽`;
}

// Обновленная настройка модального окна корзины
function setupCartModal() {
  const cartButton = document.getElementById('cart-button');
  const closeCartButton = document.getElementById('close-cart');
  const cartModal = document.getElementById('cart-modal');
  const deliveryMethod = document.getElementById('delivery-method');
  const checkoutButton = document.getElementById('checkout-btn');
  const calculateButton = document.getElementById('calculate-delivery');
  const deliveryCityInput = document.getElementById('delivery-city');
  const formCityInput = document.getElementById('form-city');
  
  cartButton.addEventListener('click', () => {
    updateCartModal();
    cartModal.style.display = 'flex';
  });
  
  closeCartButton.addEventListener('click', () => {
    cartModal.style.display = 'none';
  });
  
  cartModal.addEventListener('click', (e) => {
    if (e.target === cartModal) {
      cartModal.style.display = 'none';
    }
  });
  
  // Синхронизация полей города
  deliveryCityInput.addEventListener('input', () => {
    formCityInput.value = deliveryCityInput.value;
  });
  
  formCityInput.addEventListener('input', () => {
    deliveryCityInput.value = formCityInput.value;
  });
  
  // Расчет доставки
  calculateButton.addEventListener('click', () => {
    const city = deliveryCityInput.value.trim();
    if (city) {
      calculateDelivery(city);
    }
  });
  
  deliveryCityInput.addEventListener('keypress', (e) => {
    if (e.key === 'Enter') {
      const city = deliveryCityInput.value.trim();
      if (city) {
        calculateDelivery(city);
      }
    }
  });
  
  // Обновление стоимости при изменении способа доставки
  deliveryMethod.addEventListener('change', () => {
    updateCartModal();
  });
  
  checkoutButton.addEventListener('click', () => {
    const form = document.getElementById('cart-form');
    const formData = new FormData(form);
    const cart = JSON.parse(localStorage.getItem('cart')) || [];
    
    if (!formData.get('ФИО') || !formData.get('Город') || !formData.get('Адрес') || !deliveryMethod.value) {
      alert('Пожалуйста, заполните все поля формы');
      return;
    }
    
    if (cart.length === 0) {
      alert('Корзина пуста');
      return;
    }
    
    const deliveryCost = window.deliveryPrices ? window.deliveryPrices[deliveryMethod.value] || 0 : 0;
    
    const orderData = {
      fio: formData.get('ФИО'),
      city: formData.get('Город'),
      address: formData.get('Адрес'),
      delivery: deliveryMethod.value,
      deliveryCost: deliveryCost,
      items: cart,
      total: document.getElementById('cart-total').textContent
    };
    
    sendToTelegram(orderData);
    
    localStorage.removeItem('cart');
    updateCartCount();
    cartModal.style.display = 'none';
    alert('Заказ оформлен! Мы свяжемся с вами в ближайшее время.');
  });
}

// Остальные функции остаются без изменений
function updateCartCount() {
  const cart = JSON.parse(localStorage.getItem('cart')) || [];
  const totalCount = cart.reduce((sum, item) => sum + item.count, 0);
  document.getElementById('cart-count').textContent = totalCount;
  
  if (totalCount > 0) {
    document.getElementById('cart-container').style.display = 'block';
  } else {
    document.getElementById('cart-container').style.display = 'none';
  }
}

function setupAddButtons() {
  document.addEventListener('click', (e) => {
    if (e.target.hasAttribute('data-index') && !e.target.hasAttribute('data-action')) {
      const index = parseInt(e.target.getAttribute('data-index'));
      const product = products[index];
      let cart = JSON.parse(localStorage.getItem('cart')) || [];
      const existing = cart.find(item => item.name === product.name);
      
      if (existing) {
        existing.count++;
      } else {
        cart.push({ 
          name: product.name, 
          price: product.price, 
          count: 1,
          image: product.image
        });
      }
      
      localStorage.setItem('cart', JSON.stringify(cart));
      updateCartCount();
    }
  });
}

function setupCartControls() {
  document.addEventListener('click', (e) => {
    if (e.target.hasAttribute('data-action')) {
      const index = parseInt(e.target.getAttribute('data-index'));
      const action = e.target.getAttribute('data-action');
      let cart = JSON.parse(localStorage.getItem('cart')) || [];
      
      if (action === 'increase') {
        cart[index].count++;
      } else if (action === 'decrease') {
        cart[index].count--;
        if (cart[index].count <= 0) {
          cart.splice(index, 1);
        }
      } else if (action === 'remove') {
        cart.splice(index, 1);
      }
      
      localStorage.setItem('cart', JSON.stringify(cart));
      updateCartCount();
      updateCartModal();
    }
  });
}

function setupMenu() {
  const menuButton = document.getElementById('menu-button');
  const closeMenuButton = document.getElementById('close-menu');
  const menu = document.getElementById('menu');
  
  menuButton.addEventListener('click', () => {
    menu.classList.add('active');
  });
  
  closeMenuButton.addEventListener('click', () => {
    menu.classList.remove('active');
  });
  
  document.addEventListener('click', (e) => {
    if (!menu.contains(e.target) && e.target !== menuButton) {
      menu.classList.remove('active');
    }
  });
}

function sendToTelegram(orderData) {
  let message = `Новый заказ!\n\n`;
  message += `ФИО: ${orderData.fio}\n`;
  message += `Город: ${orderData.city}\n`;
  message += `Адрес: ${orderData.address}\n`;
  message += `Способ доставки: ${orderData.delivery === 'sdek' ? 'СДЭК' : 'Почта России'}\n`;
  message += `Стоимость доставки: ${orderData.deliveryCost} ₽\n\n`;
  message += `Товары:\n`;
  
  orderData.items.forEach(item => {
    message += `- ${item.name}: ${item.price} ₽ x ${item.count} = ${item.price * item.count} ₽\n`;
  });
  
  message += `\n${orderData.total}`;
  
  const botToken = 'YOUR_BOT_TOKEN';
  const chatId = 'YOUR_CHAT_ID';
  
  fetch(`https://api.telegram.org/bot${botToken}/sendMessage`, {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
    },
    body: JSON.stringify({
      chat_id: chatId,     
      text: message,
    }),
  })
  .then(response => response.json())
  .then(data => {
    console.log('Сообщение отправлено в Telegram:', data);
  })
  .catch(error => {
    console.error('Ошибка отправки в Telegram:', error);
  });
}

function setupBackToTop() {
  const backToTopButton = document.getElementById('back-to-top');
  
  window.addEventListener('scroll', () => {
    if (window.pageYOffset > 300) {
      backToTopButton.classList.add('visible');
    } else {
      backToTopButton.classList.remove('visible');
    }
  });
  
  backToTopButton.addEventListener('click', () => {
    window.scrollTo({
      top: 0,
      behavior: 'smooth'
    });
  });
}

// Инициализация страницы
document.addEventListener('DOMContentLoaded', () => {
  renderProducts();
  setupAddButtons();
  setupCartControls();
  setupMenu();
  setupCartModal();
  setupBackToTop();
  updateCartCount();
});
</script>
</body>
</html>
